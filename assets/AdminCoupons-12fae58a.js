import{M as x,D as L,P}from"./PaginationView-f64d28d6.js";import{_ as v,o as a,c as d,a as e,w as u,v as h,k as $,t as C,r as _,b as m,F as g,j as V}from"./index-ec405a60.js";import{S as p}from"./sweetalert2.all-2301b2d1.js";const D={props:["isNew","coupon"],data(){return{selectCoupon:{},modal:"",due_date:""}},watch:{coupon(){this.selectCoupon=this.coupon;const s=new Date(this.selectCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s}},mounted(){this.selectCoupon=this.coupon,this.modal=new x(document.querySelector("#couponModal"),{backdrop:"static",keyboard:!1})}},T={id:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true",ref:"modal"},U={class:"modal-dialog"},N={class:"modal-content border-0"},E={class:"modal-header"},A={id:"couponModalLabel",class:"modal-title"},B={key:0},O={key:1},I=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),S={class:"modal-body"},K={class:"mb-3"},R=e("label",{for:"title"},"標題",-1),F={class:"mb-3"},H=e("label",{for:"coupon_code"},"優惠碼",-1),j={class:"mb-3"},q=e("label",{for:"due_date"},"到期日",-1),z={class:"mb-3"},G=e("label",{for:"discount"},"折扣百分比",-1),J={class:"mb-3"},Q={class:"form-check"},W=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),X={class:"modal-footer"},Y=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1);function Z(s,t,n,r,o,c){return a(),d("div",T,[e("div",U,[e("div",N,[e("div",E,[e("h5",A,[n.isNew?(a(),d("span",B,"新增優惠卷")):(a(),d("span",O,"編輯優惠卷"))]),I]),e("div",S,[e("div",K,[R,u(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=i=>o.selectCoupon.title=i),placeholder:"請輸入標題"},null,512),[[h,o.selectCoupon.title]])]),e("div",F,[H,u(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=i=>o.selectCoupon.code=i),placeholder:"請輸入優惠碼"},null,512),[[h,o.selectCoupon.code]])]),e("div",j,[q,u(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=i=>o.due_date=i)},null,512),[[h,o.due_date]])]),e("div",z,[G,u(e("input",{type:"number",class:"form-control",id:"discount",min:"0",max:"100","onUpdate:modelValue":t[3]||(t[3]=i=>o.selectCoupon.percent=i),placeholder:"請輸入折扣百分比"},null,512),[[h,o.selectCoupon.percent,void 0,{number:!0}]])]),e("div",J,[e("div",Q,[u(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=i=>o.selectCoupon.is_enabled=i),id:"is_enabled"},null,512),[[$,o.selectCoupon.is_enabled]]),W])])]),e("div",X,[Y,e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=i=>s.$emit("update-coupon",o.selectCoupon))},C(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const ee=v(D,[["render",Z]]),{VITE_APP_URL:b,VITE_APP_PATH:f}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_APP_PATH:"sasimi",BASE_URL:"/vue-main-week7/",MODE:"production",DEV:!1,PROD:!0},te={data(){return{coupons:[],pagination:{},selectCoupon:{title:"",is_enabled:0,percent:100,code:""},currentPage:1,isLoading:!1,isNew:!1}},methods:{getCoupons(s=1){const t=`${b}/api/${f}/admin/coupons?page=${s}`;this.isLoading=!0,this.$http.get(t).then(n=>{this.isLoading=!1,this.coupons=n.data.coupons,this.pagination=n.data.pagination}).catch(n=>{this.isLoading=!1,p.fire({icon:"error",title:`錯誤 ${n.response.status}`,text:n.response.data.message,confirmButtonText:"OK"})})},updateCoupon(s){let t=`${b}/api/${f}/admin/coupon`,n="post",r={...s};this.isNew||(t=`${b}/api/${f}/admin/coupon/${this.selectCoupon.id}`,n="put",r=this.selectCoupon),this.isLoading=!0,this.$http[n](t,{data:r}).then(o=>{this.getCoupons(this.currentPage),this.selectCoupon.title="",this.selectCoupon.code="",this.selectCoupon.percent=100,this.selectCoupon.is_enabled=0,this.$refs.couponModal.modal.hide(),this.isLoading=!1,this.isNew||p.fire({icon:"success",title:o.data.message,confirmButtonText:"OK"})}).catch(o=>{this.isLoading=!1,p.fire({icon:"error",title:`錯誤 ${o.response.status}`,text:o.response.data.message,confirmButtonText:"OK"})})},deleteCoupon(){const s=`${b}/api/${f}/admin/coupon/${this.selectCoupon.id}`;this.isLoading=!0,this.$http.delete(s).then(t=>{this.isLoading=!1,this.getCoupons(this.currentPage),this.$refs.delModal.modal.hide(),p.fire({icon:"success",title:t.data.message,confirmButtonText:"OK"})}).catch(t=>{this.isLoading=!1,p.fire({icon:"error",title:`錯誤 ${t.response.status}`,text:t.response.data.message,confirmButtonText:"OK"})})},openModal(s){s?(console.log("Update"),this.isNew=!1,this.selectCoupon={...s}):(this.isNew=!0,this.selectCoupon={...this.selectCoupon,due_date:new Date().getTime()/1e3}),this.$refs.couponModal.modal.show()},openDelModal(s){this.selectCoupon={...s},this.$refs.delModal.modal.show()}},components:{DeleteModal:L,CouponModal:ee,PaginationView:P},mounted(){this.getCoupons()}},oe={class:"container"},se={class:"text-end mt-4"},ne={class:"table mt-4"},ie=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),le={key:0,class:"text-success"},ae={key:1},de={class:"btn-group"},ce=["onClick"],ue=["onClick"];function pe(s,t,n,r,o,c){const i=_("LoadingView"),M=_("PaginationView"),w=_("CouponModal"),y=_("DeleteModal");return a(),d(g,null,[e("div",oe,[m(i,{active:o.isLoading,"onUpdate:active":t[0]||(t[0]=l=>o.isLoading=l)},null,8,["active"]),e("div",se,[e("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=l=>c.openModal(""))}," 建立新的優惠券 ")]),e("table",ne,[ie,e("tbody",null,[(a(!0),d(g,null,V(o.coupons,l=>(a(),d("tr",{key:l.id},[e("td",null,C(l.title),1),e("td",null,C(l.percent),1),e("td",null,C(s.$filters.date(l.due_date)),1),e("td",null,[l.is_enabled?(a(),d("span",le,"啟用")):(a(),d("span",ae,"未啟用"))]),e("td",null,[e("div",de,[e("button",{type:"button",onClick:k=>c.openModal(l),class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,ce),e("button",{type:"button",onClick:k=>c.openDelModal(l),class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,ue)])])]))),128))])]),m(M,{pages:o.pagination,onEmitPage:c.getCoupons},null,8,["pages","onEmitPage"])]),m(w,{ref:"couponModal","is-new":o.isNew,coupon:o.selectCoupon,onUpdateCoupon:c.updateCoupon},null,8,["is-new","coupon","onUpdateCoupon"]),m(y,{ref:"delModal",item:o.selectCoupon,onDelItem:c.deleteCoupon},null,8,["item","onDelItem"])],64)}const me=v(te,[["render",pe]]);export{me as default};
